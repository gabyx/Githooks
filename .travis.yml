language: go
os: linux
dist: bionic

go:
  - 1.15.8

services:
  - docker

install: skip

jobs:
  allow_failures:
    - name: coverage

  include:
    - os: linux
      name: coverage
      env:
        - TEST_INSTANCE=test-coverage
        - COVERALLS_TOKEN=$COVERALLS_TOKEN
    - os: windows
      env: TEST_INSTANCE=test-windows-go
    - os: linux
      env: TEST_INSTANCE=test-alpine-go
    - os: linux
      env: TEST_INSTANCE=test-alpine-go-user
    - os: linux
      env: TEST_INSTANCE=test-alpine-nolfs-go
    - os: linux
      env: TEST_INSTANCE=test-corehookspath-go
    - os: linux
      env: TEST_INSTANCE=test-whitespace-go
    - os: linux
      env: TEST_INSTANCE=test-rules

script:
  - echo "$DOCKER_TOKEN" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - sh "tests/${TEST_INSTANCE}.sh"
